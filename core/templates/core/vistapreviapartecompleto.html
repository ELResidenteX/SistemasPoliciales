{% load humanize %}

<div class="modal-header">
  <h5 class="modal-title">Vista Previa - Parte Policial</h5>
  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
</div>

<div class="modal-body">
  <div class="text-end mb-2">
    <button class="btn btn-outline-secondary btn-sm" onclick="imprimirModalParte()">üñ®Ô∏è Imprimir Parte</button>
  </div>

  <div id="contenido-para-imprimir" style="font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.5;">
    <!-- Tu contenido completo -->
    <h2 style="text-align: center;">PARTE POLICIAL N¬∞ {{ evento.parte_policial.numero_parte }}</h2>

    <h4>ANTECEDENTES DE LA DENUNCIA</h4>
    <p><strong>Nro Parte:</strong> {{ evento.parte_policial.numero_parte }}</p>
    <p><strong>Lugar procedimiento:</strong> {{ evento.lugar_procedimiento }}</p>
    <p><strong>Fecha Denuncia:</strong> {{ evento.fecha_denuncia }}</p>
    <p><strong>Hora Denuncia:</strong> {{ evento.hora_denuncia }}</p>

    <h4>FUNCIONARIO RESPONSABLE</h4>
    <p><strong>Funcionario C√≥digo:</strong> {{ evento.funcionaria_codigo }}</p>
    <p><strong>Rut:</strong> {{ evento.funcionaria_rut }}</p>

    <h4>ANTECEDENTES DEL DELITO</h4>
    <p><strong>Delito tipificado:</strong> {{ evento.delito_tipificado }}</p>
    <p><strong>Fecha delito:</strong> {{ evento.fecha_ocurrencia }}</p>
    <p><strong>Hora delito:</strong> {{ evento.hora_ocurrencia }}</p>
    <p><strong>Tipo lugar:</strong> {{ evento.tipo_lugar }}</p>

    <h4>UBICACI√ìN</h4>
    <p><strong>Regi√≥n:</strong> {{ evento.region }}</p>
    <p><strong>Provincia:</strong> {{ evento.provincia }}</p>
    <p><strong>Comuna:</strong> {{ evento.comuna }}</p>
    <p><strong>Direcci√≥n:</strong> {{ evento.direccion }}</p>
    <p><strong>N√∫mero:</strong> {{ evento.numero }}</p>
    <p><strong>Block:</strong> {{ evento.block }}</p>
    <p><strong>Villa:</strong> {{ evento.villa }}</p>
    <p><strong>Depto:</strong> {{ evento.depto }}</p>

    {% if evento.participantes.all %}
      <h4>IDENTIFICACI√ìN DE PARTICIPANTES</h4>
      {% for p in evento.participantes.all %}
        <p><strong>Nombres:</strong> {{ p.nombres }} ‚Äî <strong>Fecha de Nacimiento:</strong> {{ p.fecha_nacimiento|date:"d/m/Y" }} ‚Äî <strong>Edad:</strong> {{ p.edad }}</p>
        <p><strong>Apellidos:</strong> {{ p.apellidos }} ‚Äî <strong>Sexo:</strong> {{ p.sexo }}</p>
        <p><strong>RUT:</strong> {{ p.rut }} ‚Äî <strong>Nacionalidad:</strong> {{ p.nacionalidad }}</p>
        <p><strong>Tel√©fono:</strong> {{ p.telefono }}</p>
        <p><strong>Calidad:</strong> {{ p.get_calidad_display }}</p>
        <p><strong>Direcci√≥n Completa:</strong> {{ p.region }}, {{ p.provincia }}, {{ p.comuna }},
          {{ p.direccion }} N¬∫ {{ p.numero_calle }}, Block {{ p.block }}, Villa {{ p.villa }}, Depto {{ p.depto }}</p>
        <hr>
      {% endfor %}
    {% endif %}

    {% if evento.especies.all %}
      <h4>ESPECIES INVOLUCRADAS</h4>
      <table style="width: 100%; border-collapse: collapse;" border="1">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Descripci√≥n</th>
            <th>Cantidad</th>
            <th>Aval√∫o estimado</th>
          </tr>
        </thead>
        <tbody>
          {% for e in evento.especies.all %}
            <tr>
              <td>{{ e.tipo }}</td>
              <td>{{ e.descripcion }}</td>
              <td>{{ e.cantidad }}</td>
              <td>${{ e.avaluo_estimado|floatformat:0|intcomma }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}

    <h4>NARRACI√ìN DE LOS HECHOS</h4>
    <p style="white-space: pre-line;">{{ evento.narracion_hechos }}</p>

    <h4>Firmas</h4>
    {% if evento.firma_funcionario %}
      <div>
        <strong>Firma Funcionario:</strong><br>
        <img src="{{ evento.firma_funcionario.url }}" alt="Firma Funcionario" style="max-width:250px; max-height:120px; border:1px solid #ccc;"/>
      </div>
    {% else %}
      <div><em>No hay firma del funcionario</em></div>
    {% endif %}

    {% if evento.firma_denunciante %}
      <div>
        <strong>Firma Denunciante o V√≠ctima:</strong><br>
        <img src="{{ evento.firma_denunciante.url }}" alt="Firma Denunciante" style="max-width:250px; max-height:120px; border:1px solid #ccc;"/>
      </div>
    {% else %}
      <div><em>No hay firma de denunciante</em></div>
    {% endif %}
  </div>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
</div>

<script>
  function imprimirModalParte() {
    const contenido = document.getElementById('contenido-para-imprimir').innerHTML;
    const ventana = window.open('', '_blank');
    ventana.document.write(`
      <html>
        <head>
          <title>Imprimir Parte Policial</title>
          <style>
            body { font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.5; padding: 20px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid black; padding: 4px; }
          </style>
        </head>
        <body>${contenido}</body>
      </html>
    `);
    ventana.document.close();
    ventana.focus();
    ventana.print();
  }
</script>





